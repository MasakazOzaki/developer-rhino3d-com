<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Deployment to a Virtual Machine running IIS with C#, VB</title>
  <meta name="description" content="How to deploy compute for production on a virtual machine running Internet Information Services (IIS).  Using C#, VB">

  <!-- OpenGraph for Facebook, Twitter, Slack unfurling -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/guides/compute/deploy-to-iis/" />
  <meta property="og:title" content="Deployment to a Virtual Machine running IIS" />
  <meta property="og:description" content="How to deploy compute for production on a virtual machine running Internet Information Services (IIS)." />
  <meta property=”og:site_name” content="developer.rhino3d.com"/>
  <meta property=”og:image” content="http://developer.rhino3d.com/images/rhinodev-logo-unfurl.png"/>

  <!-- twitter card tags additive with the og: tags -->
  <meta name="twitter:domain" value="developer.rhino3d.com" />
  <meta name="twitter:title" value="Deployment to a Virtual Machine running IIS" />
  <meta name="twitter:description" value="How to deploy compute for production on a virtual machine running Internet Information Services (IIS)." />
  
    <meta name="twitter:image" content="http://developer.rhino3d.com/images/rhinodev-logo-unfurl.png" />
  
  <meta name="twitter:url" value="http://developer.rhino3d.com" />
  
  <meta name="twitter:label1" value="Platform(s)" />
  <meta name="twitter:data1" value="Windows" />
  
  
  <meta name="twitter:label2" value="Language(s)" />
  <meta name="twitter:data2" value="C#, VB" />
  

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/vbnet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="/wip/node_modules/highlightjs-line-numbers.js/dist/highlightjs-line-numbers.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>hljs.initLineNumbersOnLoad();</script>

  <!-- Overridden theme -->
  <link rel="stylesheet" href="/wip/css/main.css">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"> -->
  <!-- Bootstrap override -->
  <link rel="stylesheet" href="/wip/css/bootstrap-override.css">

  <link rel="canonical" href="http://developer.rhino3d.com/wip/guides/compute/deploy-to-iis/">
  <link rel="alternate" type="application/rss+xml" title="Rhino Developer Docs" href="http://developer.rhino3d.com/wip/feed.xml" />

  <link rel="shortcut icon" href="https://developer.rhino3d.com/favicon.ico?v=2" />
  <!-- Saving bookmarks to mobile devices -->
  <!-- For non-Retina (@1× display) iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="/wip/images/apple-touch-icon-precomposed.png"><!-- 57×57px -->
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/wip/images/apple-touch-icon-72x72-precomposed.png">
  <!-- For the iPad mini and the first- and second-generation iPad (@1× display) on iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/wip/images/apple-touch-icon-76x76-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/wip/images/apple-touch-icon-114x114-precomposed.png">
  <!-- For iPhone with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/wip/images/apple-touch-icon-120x120-precomposed.png">
  <!-- For iPad with @2× display running iOS ≤ 6: -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/wip/images/apple-touch-icon-144x144-precomposed.png">
  <!-- For iPad with @2× display running iOS ≥ 7: -->
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/wip/images/apple-touch-icon-152x152-precomposed.png">
  <!-- For iPhone 6 Plus with @3× display: -->
  <link rel="apple-touch-icon-precomposed" sizes="180x180" href="/wip/images/apple-touch-icon-180x180-precomposed.png">
  <!-- For Chrome for Android: -->
  <link rel="icon" sizes="192x192" href="/wip/images/touch-icon-192x192.png">

  <!-- Enable crawling because this version is the stable version -->
  <!--<meta name="robots" content="noindex" />-->
</head>


  <body>

    <!-- Google Tag Manager **This belongs right after the <body> tag**-->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-MWMDKN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-MWMDKN');
    </script>
    <!-- End Google Tag Manager -->


    

<!-- The following are "casts" from the string to number using math filters... -->



<!-- ...but we need to check to see if the original branches were numbers or not... -->









  <div class="version-banner version-banner-warning">

    
      <strong>WARNING:</strong> You're viewing the <strong>Rhino WIP</strong> version of this page! <a href="/guides/compute/deploy-to-iis/">View the current version instead.</a>
    
</div>

<!-- Check the version banner for broken links and remove the link if found -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<!-- <script>
$(document).ready(function()
{
  var splitPath = window.location.pathname.split("/");
  var linkURL = "/" + splitPath.splice(2,splitPath.length-2).join("/");

  $.get(linkURL).fail(function ()
  {
    var $aTag = $("div.version-banner > a");
    $aTag.text("View the current site instead.");
    $aTag.attr("href", "/");
  });
});
</script> -->


    <div class="container">

      <header class="site-header">


    <a class="site-title" href="/wip/"><img src="/wip/images/rhinodevlogo148x128.png" alt="Rhino Developer Docs" height="48" width="56"></a><a class="site-title" href="/wip/">Rhino Developer Docs</a>

    <nav class="site-nav">
      <img class="menu-icon" src="/wip/images/gi.svg">
      
      <div class="trigger">
      	<!--<a class="page-link" href="/wip/">Welcome</a>-->
        <!-- get current page title and "collection" to figure out which nav
             link should be "active" -->
        
        
        
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
            
              
                
              
            
          
        
          
        
          
            
              
            
          
        
          
            
              
                
                  
                    <a class="page-link active" href="/wip/guides/">Guides</a>
                    
                  
              
            
          
        
          
            
              
                
                  
                    <a class="page-link" href="/wip/api/">API</a>
                    
                  
              
            
          
        
          
            
              
                
                  
                    <a class="page-link" href="/wip/samples/">Samples</a>
                    
                  
              
            
          
        
          
            
          
        
          
            
              
                
                  
                    <a class="page-link" href="/wip/videos/">Videos</a>
                    
                  
              
            
          
        
        <a class="page-link" href="https://discourse.mcneel.com/c/rhino-developer">Forums</a>
        <!-- Google Search Engine -->
        <!-- TODO Move to this site back into the Mcneel search, or use a simple site only search for results -->
        <div id="sitesearch">
            <!-- CSE Search Box Begins  -->
            <form id="search-box" name="search-box" onsubmit="sitesearchFunction()" action="/wip/search-results.html">
                <input id="searchtext" type="search" name="q" size="24" value="" placeholder="Search" />
                <input class="searchBox" type="submit" size="2" value=" " />
            </form>
			<script type="text/javascript">
			function sitesearchFunction(){
				var form_id = document.getElementById("search-box");
				var form_action = form_id.action;
                var form_sb = document.getElementById("searchtext");
				var query_src = form_sb.value + " site:developer.rhino3d.com";
				form_sb.value = query_src.toString();
			}
			</script>
<!-- Google CSE Search Box Ends -->
        </div>
        <!--End of Google Search Engine -->
      </div>
    </nav>

</header>


      <div class="page-content">
        <!--div class="wrapper"-->
          <div class="container-fluid">

<div class="row-fluid">
    <!--Nav Bar -->
    <nav class="col-xs-0 col-md-3 bs-docs-sidebar">
    <ul id="sidebar" class="nav nav-stacked fixed">
        <!-- Find the h2 group and any h3 subgroups -->
        

        
          

          
            
            
            
            
            <li>
              <a href="#overview">Overview</a>

              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#create-the-vm">Create the VM</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#connect-via-rdp">Connect via RDP</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#configuring-the-vm">Configuring the VM</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#open-firewall-port">Open Firewall Port</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#install-rhino">Install Rhino</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#install-iis">Install IIS</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#install-net-core-hosting-bundle">Install .NET Core Hosting...</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#publish-rhinocompute">Publish rhino.compute</a>

              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#create-the-app-in-iis">Create the app in IIS</a>

              
                <ul class="nav nav-stacked">
                  

                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#setup-the-app-pool--site">Setup the App Pool &amp; ...</a>
                    </li>
                  
                    
                    
                    
                    
                    
                    <li>
                        <a href="#edit-permissions">Edit Permissions</a>
                    </li>
                  

                </ul>
              

            </li>
          

        
          

          
            
            
            
            
            <li>
              <a href="#testing-the-app">Testing the app</a>

              

            </li>
          

        
    </ul>
</nav>


    <!--Main Content -->
    <div class="col-xs-12 col-md-9">
      <!--<div class="post">-->

        <article class="post-content">

          <ol class="breadcrumb">
              
              
              
              
              <li><a href="/wip/guides/compute">Compute</a></li>

              
                
                  <li class="active">Deployment</li>
                
              
          </ol>

          <h1>Deployment to a Virtual Machine running IIS</h1>

          <p>
  <span class="guide_byline">
    
      
      by <a href="/wip/authors/andy_payne">Andy Payne</a> (Last modified: <a href="https://github.com/mcneel/developer-rhino3d-com/commits/master/_guide_topics/compute/deploy-to-iis.md" target="_blank">13 Dec 2021</a>)
    
  </span>

</p>

          <p>How to deploy compute for production on a virtual machine running Internet Information Services (IIS).</p>

          <h2 id="overview">Overview</h2>

<p>This guide will walk you through how to setup an instance of rhino.compute on a virtual machine running Internet Information Services (IIS). <a href="https://www.iis.net/">IIS</a>, is a flexible, general-purpose web server developed by Microsoft which can be configured to serve requested HTML pages or files. We can setup IIS to process incoming requests (either from Hops or some other client) and forward that request to the rhino.compute instance.</p>

<p>You may be asking yourself, “Why do I need IIS at all? Why can’t I simply launch the rhino.compute server and send API requests directly to that instance?”. Technically speaking, you don’t need IIS. However, you would need to figure out how to relaunch the compute server should it crash or malfunction. You would also need to configure rhino.compute to launch whenever the virtual machine is launched.</p>

<p>One of the main benefits of using IIS as a middleware is that it can automatically spin up an instance of the rhino.compute server whenever a request is recieved. With this configuration, you do not have to have compute running continuously. Instead, IIS can launch an instance of compute when it is needed which in turn will launch one or more child processes. These child processes are what perform the actual computation and also what require your license authorization.</p>

<p>When rhino.compute.exe does not receive requests to solve over a period of seconds (this is called idlespans and the default is set to 1 hour), child compute.geometry.exe processes will shut down and stop incurring core hour billing. At some date in the future when a new request is received, IIS will make sure that rhino.compute.exe is running which will then relaunch the child processes. Note, there may be some small delay in the response while the child processes are launching.</p>

<p><img src="/wip/images/IIS_Request.png" class="img-center" width="100%" /></p>
<figcaption align="left"><b>Fig.1 - A flow diagram showing how IIS recieves an incoming request and launches rhino.compute.exe which in turn spins up child processes.</b></figcaption>

<h2 id="create-the-vm">Create the VM</h2>

<p>The first step in the process of deploying <strong>rhino.compute</strong> to a remote instance is to set up a virtual machine (VM). There are several popular services which can be configured to setup a wide array of virtual machines depending on your resource needs. Two of the most prominent providers include <a href="https://azure.microsoft.com/en-us/free/virtual-machines/">Azure</a> and <a href="https://aws.amazon.com/ec2/instance-types/">AWS</a>.</p>

<p>Depending on your preferences, we recommend starting with an Azure or AWS VM. Use the following guides to walkthrough that process.</p>

<ul>
  <li>
    <p><a href="https://developer.rhino3d.com/guides/compute/creating-an-Azure-VM">Create a Virtual Machine on Azure</a>.</p>
  </li>
  <li>
    <p>Create a Virtual Machine on AWS (coming soon).</p>
  </li>
</ul>

<h3 id="connect-via-rdp">Connect via RDP</h3>

<p>Now that we’ve configured the virtual machine, we need to be able to log onto it so that we can setup IIS and the rhino.compute instance. We’ll do this by using a remote desktop protocol (RDP) which connects two computers over a network.</p>

<p>To start, let’s download the RDP file for our Azure VM.</p>

<ol>
  <li>
    <p>First, make sure the virtual machine is running. Click on the <strong>Overview</strong> tab in the left-hand menu. If the <em>Status</em> says <em>Stopped (Deallocated)</em>, click on the <strong>Start</strong> button at the top to start the remote machine. After a few seconds, the status should say <em>Running</em>.</p>
  </li>
  <li>
    <p>Click on the <strong>Connect</strong> menu item in the left-hand menu to pull out the connection settings blade.</p>
  </li>
  <li>
    <p>Click on the <strong>Download RDP File</strong> button and save the file somewhere on your computer.
<img src="/wip/images/Azure_VM_Connect1.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Click on the Windows <strong>Start</strong> menu and start typing <em>remote desktop connection</em> in the search bar. Click on the link to launch app.</p>
  </li>
  <li>
    <p>Click on the button at the bottom of the app to <strong>Show Options</strong></p>
  </li>
  <li>
    <p>Under the <em>Connection Settings</em> area, select <strong>Open</strong> and navigate to the directory where you saved your RDP file. Choose that file and hit Open.</p>
  </li>
  <li>
    <p>Select the checkbox to <strong>Allow me to save credentials</strong></p>
  </li>
  <li>
    <p>Click <strong>Connect</strong>.
<img src="/wip/images/Azure_VM_Connect2.png" class="img-center" width="60%" /></p>
  </li>
  <li>
    <p>A security pop-up will be opened. Click the checkbox for <strong>Don’t ask me again for connections to this computer</strong> and then click <strong>Connect</strong>.</p>
  </li>
  <li>
    <p>Enter the administrator credentials that you entered in step 7 of <a href="https://developer.rhino3d.com/guides/compute/deployToIIS/#setting-up-a-virtual-machine">Creating a Virtual Machine</a>.</p>
  </li>
  <li>
    <p>You may see another security pop-up. Again, select <strong>Don’t ask me again for connections to this computer</strong> and click <strong>Yes</strong>.</p>
  </li>
</ol>

<p>Congratulations. You should now have access to the desktop of the remote machine running Windows Server 2022.</p>

<h2 id="configuring-the-vm">Configuring the VM</h2>

<p>Now that you have logged into the virtual machine via RDP, let’s take a look at how to setup Windows Server to host our instance of rhino.compute.</p>

<h3 id="open-firewall-port">Open Firewall Port</h3>

<p>We have already created an inbound port rule for the Azure network interface and the Windows firewall already has inbound port rules to allow HTTP traffic on port 80 and HTTPS traffic on port 443. However, we must also create a rule to allow ICMP messages through the Windows firewall.</p>

<ol>
  <li>
    <p>Launch <strong>Powershell</strong> (right-click to <strong>Run as Administrator</strong>).</p>
  </li>
  <li>
    <p>Type in the following commands:</p>

    <pre><code> # For IPv4
 netsh advfirewall firewall add rule name="ICMP Allow incoming V4 echo request" protocol="icmpv4:8,any" dir=in action=allow
 
 # For IPv6
 netsh advfirewall firewall add rule name="ICMP Allow incoming V6 echo request" protocol="icmpv6:8,any" dir=in action=allow 
</code></pre>
  </li>
  <li>
    <p>You should see an <strong>OK</strong> message after each command.</p>
  </li>
  <li>
    <p>Now, Restart your virtual machine.</p>
  </li>
</ol>

<p>You should be able to ping your Azure virtual machine using your public IP address. Note: your IP address will be different than the one shown below.
<img src="/wip/images/Ping_IPAddress.png" class="img-center" width="85%" /></p>

<h3 id="install-rhino">Install Rhino</h3>

<p>Next we need to install Rhino on the virtual machine and setup core-hour billing.</p>

<ol>
  <li>
    <p><a href="https://www.rhino3d.com/download/rhino-for-windows/7/latest">Download the Rhino 7.0</a>.</p>
  </li>
  <li>
    <p><a href="https://developer.rhino3d.com/guides/compute/core-hour-billing/">Follow this guide</a> for setting up core-hour billing on the virtual machine.</p>
  </li>
</ol>

<h3 id="install-iis">Install IIS</h3>

<p>By default, IIS is not enabled on Windows Server. To install IIS on the virtual machine, follow these steps.</p>

<ol>
  <li>
    <p>Open the <strong>Server Manager</strong> console. This usually opens by default after startup, however if its not there, click on the <strong>Start</strong> menu and search for <em>Server Manager</em>.</p>
  </li>
  <li>
    <p>Click the <strong>Add roles and features</strong> button.
<img src="/wip/images/IIS_Setup_1.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Click <strong>Next</strong> on the <strong>Before you begin</strong> page</p>
  </li>
  <li>
    <p>On the <strong>Installation type</strong> page, select <strong>Role-based or feature-based installation</strong>.
<img src="/wip/images/IIS_Setup_2.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>We will be installing IIS on this local machine, so leave <strong>Select a server from the server pool</strong> checked.</p>
  </li>
  <li>
    <p>Click <strong>Next</strong>.
<img src="/wip/images/IIS_Setup_3.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>On the <strong>Select server roles</strong> page, check the box next to <strong>Web Server (IIS)</strong>. A pop-up dialog will be opened advising that additional features are required. Click the <strong>Add Features</strong> button to install these as well.</p>
  </li>
  <li>
    <p>Click <strong>Next</strong>.
<img src="/wip/images/IIS_Setup_4.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>On the <strong>Select features</strong> page, add all of the checkboxes under the <strong>.NET Framework 4.8 Features</strong>. Then scroll down and make sure the <strong>IIS Hostable Web Core</strong> checkbox is checked. Click Next.
<img src="/wip/images/IIS_Setup_18.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>On the <strong>Select role services</strong> page, review the available features that are available. For now, we will simply leave the default selections, but you can always come back and add more later.</p>
  </li>
  <li>
    <p>Click <strong>Next</strong>.
<img src="/wip/images/IIS_Setup_6.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Finally, on the <strong>Confirmation</strong> page, review the items that are going to be installed on the VM. When satisfied, click the <strong>Install</strong> button. Note, no reboot should be required with a standard IIS installation. However, if you remove the role a reboot will be needed.
<img src="/wip/images/IIS_Setup_7.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Once the installation has succeeded, click the <strong>Close</strong> button. At this point, IIS should be running on port 80 (by default).
<img src="/wip/images/IIS_Setup_8.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>You can now open the <strong>IIS Manager</strong> app by clicking on the Windows <strong>Start</strong> menu and searching for *IIS Manager**. This will launch the IIS Manager console app. We won’t do anything in the IIS Manager just yet, but you should be able to confirm that IIS is now operational on the VM.
<img src="/wip/images/IIS_Setup_9.png" class="img-center" width="100%" /></p>
  </li>
</ol>

<h3 id="install-net-core-hosting-bundle">Install .NET Core Hosting Bundle</h3>

<p>The first thing we need to do is install the <em>.NET Core Hosting Bundle</em> on the VM in order to run rhino.compute (an ASP.NET Core app) on the VM. The bundle installs the .NET Core Runtime, .Net Core Library, and the ASP.NET Core Module which allows ASP.NET Core apps to run behind IIS. Before we can install the .NET Core Hosting Bundle, we need to make sure the</p>

<ol>
  <li>
    <p>Download the <a href="https://dotnet.microsoft.com/download/dotnet/thank-you/runtime-aspnetcore-5.0.12-windows-hosting-bundle-installer">.NET Core Hosting Bundle (direct download)</a> Note: Rhino.compute currently targets the .NET Core 5.0 Framework.</p>
  </li>
  <li>
    <p>Restart your virtual machine.</p>
  </li>
</ol>

<h2 id="publish-rhinocompute">Publish rhino.compute</h2>

<p>The next step in the process will be to publish the <code>rhino.compute</code> and <code>compute.geometry</code> projects. In order to do this, you will need to have the <a href="https://visualstudio.microsoft.com/">Visual Studio 2019 IDE</a> and <a href="https://git-scm.com/downloads">Git</a> installed on your machine.</p>

<p>You have two options as to where you can install these applications. You can either install these on virtual machine and publish the rhino.compute applications locally, or you can install these on a different machine and then copy/paste the published files over to the VM. In this walkthrough, I will choose the later approach.</p>

<ol>
  <li>
    <p>Go to <a href="https://github.com/mcneel/compute.rhino3d">https://github.com/mcneel/compute.rhino3d</a> and clone the repo to a directory on your machine. To do this:</p>

    <ul>
      <li>Open <strong>Powershell</strong> and navigate to a directory where you want to clone the repository.</li>
      <li>Type <code>$ git clone https://github.com/mcneel/compute.rhino3d.git compute</code> into the terminal.</li>
      <li>Press <strong>Enter</strong> to create a local clone of the rhino.compute repo on your machine.</li>
    </ul>
  </li>
  <li>
    <p>Next, launch <strong>Visual Studio</strong></p>
  </li>
  <li>
    <p>Choose <strong>Open a Project or Solution</strong> and navigate to the directory where you cloned the repo, then choose the <strong>src</strong> subfolder. Choose the <strong>compute.sln</strong> file and choose <strong>Open</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Solution Explorer</strong> you should see two projects. One is called <strong>rhino.compute</strong> and the other <strong>compute.geometry</strong>. Right-click on the <strong>rhino.compute</strong> project and select <strong>Publish</strong> from the menu.
<img src="/wip/images/Compute_Publish_2.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>A new <strong>Publish</strong> dialog will be opened. For the <strong>Target</strong> choose the <strong>Folder</strong> option.
<img src="/wip/images/Compute_Publish_3.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Next you will be asked for a directory to save all of the published files. You can choose any location but I have created a directory called <em>compute-for-IIS</em>. Inside this folder, I’ve created two subfolders called <em>rhino.compute</em> and <em>compute.geometry</em>. Select the <em>rhino.compute</em> subfolder as the target location to save the files. 
<img src="/wip/images/Compute_Publish_4.png" class="img-center" width="100%" />
Your folder structure looks like this:</p>

    <pre><code> * compute-for-IIS
     * rhino.compute
     * compute.geometry
</code></pre>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.</p>
  </li>
  <li>
    <p>Back in the Visual Studio <strong>Publish</strong> window, select <strong>Show all settings</strong>.
<img src="/wip/images/Compute_Publish_5.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Publish</strong> setting dialog, select <strong>Settings</strong>. Make sure that the <strong>Configuration</strong> is set to <em>Release</em>, <strong>Deployment Mode</strong> is set to <em>Self-contained</em>, and the <strong>Target Runtime</strong> is set to <em>win-x64</em>. Leave all other defaults.</p>
  </li>
  <li>
    <p>Click <strong>Save</strong>.
<img src="/wip/images/Compute_Publish_6.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Click the <strong>Publish</strong> button to begin the process of saving the rhino.compute project to the target directory.
<img src="/wip/images/Compute_Publish_7.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Now, we have to go through a similar process to publish all of the files for the compute.geometry project. This time, right-click on the <strong>compute.geometry</strong> project in the <strong>Solution Explorer</strong> and select <strong>Publish</strong>.
<img src="/wip/images/Compute_Publish_8.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>Choose <strong>Folder</strong> as the <strong>Target</strong> type, just like in step 5.</p>
  </li>
  <li>
    <p>This time, set the <em>compute.geometry</em> subfolder that you created in step 6.</p>
  </li>
  <li>
    <p>Click <strong>Finish</strong>.
<img src="/wip/images/Compute_Publish_9.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>We can leave all of the other configuration settings to their defaults. Click <strong>Publish</strong> to save the files to the target directory.</p>
  </li>
</ol>

<p><br />
At this point, you should have a folder on your machine labeled <strong>compute-for-IIS</strong>. Inside that folder, you should have two subfolders each of which contain a number of files. Next, we need to copy those two subfolders over to a directory on the virtual machine.</p>

<p>If you aren’t already logged into your virtual machine through the <strong>Remote Desktop Connection</strong> app, please do so now.</p>

<p>When we installed IIS on the virtual machine, it created a folder called <em>inetpub</em> on the <em>C:\</em> drive.</p>

<p>The folder structure looks like this:</p>

<pre><code>* C:\inetpub
    * custerr
    * history
    * logs
    * temp
    * wwwroot
        * aspnet_client
            * system_web
                *4_0_30319   &lt;- copy/paste rhino.compute and compute.geometry folders here 
</code></pre>

<p>We need to copy/paste the contents of the <strong>compute-for-IIS</strong> folder (the two subfolders) into the <strong>4_0_30319</strong> directory.</p>

<p><img src="/wip/images/Compute_Publish_11.png" class="img-center" width="100%" /></p>

<p>In the next step, we will create an IIS application and point it to this directory in order to launch an instance of rhino.compute when it receives an API request.</p>

<h2 id="create-the-app-in-iis">Create the app in IIS</h2>

<h3 id="setup-the-app-pool--site">Setup the App Pool &amp; Site</h3>

<p>Our next step will be to create an application in IIS and link it to the rhino.compute directory. To start we’ll need to create a new <strong>app pool</strong> in IIS.</p>

<ol>
  <li>
    <p>Select the Windows <strong>Start</strong> button and type <em>IIS</em> in the search bar. Click on the <strong>Internet Information Services (IIS) Manager</strong> app to launch the IIS Manager.</p>
  </li>
  <li>
    <p>In the <strong>Connections</strong> pane on the left-hand side of the IIS Manager you should see two items: 1) Start Page and 2) Rhino-Compute-VM (or whatever you named your virtual machine). Click on the carat to the left of the VM name to expand the submenu.</p>
  </li>
  <li>
    <p>Select the <strong>Application Pools</strong> submenu item.</p>
  </li>
  <li>
    <p>In the <strong>Actions</strong> pane on the far right, click the <strong>Add Application Pool</strong> button.
<img src="/wip/images/IIS_Setup_10.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Add Application Pool</strong> dialog, type <em>RhinoComputeAppPool</em> in the <strong>Name</strong> input. Set the <strong>.NET CLR version</strong> to <strong>No Managed Code</strong>. Leave all other defaults.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to add the new app pool.
<img src="/wip/images/IIS_Setup_11.png" class="img-center" width="45%" /></p>
  </li>
  <li>
    <p>Under the <strong>Actions</strong> pane, click <strong>Advanced Settings</strong>.
<img src="/wip/images/IIS_Setup_12.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Advanced Settings</strong> dialog, scroll down to the <strong>Process Model</strong> section. Change the <strong>Load User Profile</strong> to <strong>True</strong>.
<img src="/wip/images/IIS_Setup_23.png" class="img-center" width="65%" /></p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to close the <strong>Advanced Settings</strong> dialog.</p>
  </li>
  <li>
    <p>Now, in the <strong>Connections</strong> pane, click on the <strong>Sites</strong> menu item.</p>
  </li>
  <li>
    <p>In the <strong>Actions</strong> pane, select <strong>Add Website</strong>.
<img src="/wip/images/IIS_Setup_16.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Add Website</strong> dialog, set the <strong>Site name</strong> to <strong>Rhino.Compute</strong>.</p>
  </li>
  <li>
    <p>Click the <strong>Select</strong> button and set the <strong>Application Pool</strong> to <strong>RhinoComputeAppPool</strong>.</p>
  </li>
  <li>
    <p>Click the <strong>ellipsis</strong> button next to the <strong>Physical path</strong> and select the <strong>rhino.compute</strong> directory (ie. C:\inetpub\wwwroot\compute-for\IIS\rhino.compute).</p>
  </li>
  <li>
    <p>Under the <strong>Binding</strong> section, type <strong>80</strong> to bind the application to incoming messages on port 80. For now, leave the binding type to <strong>http</strong>.
<img src="/wip/images/IIS_Setup_17.png" class="img-center" width="80%" /></p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to create the site.</p>
  </li>
  <li>
    <p>At this point, you may see a popup that says you are trying to use the same binding as another site. This is because the <strong>Default Site</strong> that IIS set up during the initial configuration is also bound on port 80. Click <strong>Yes</strong> and we will edit the binding on the Default Site in a minute.
<img src="/wip/images/IIS_Setup_26.png" class="img-center" width="60%" /></p>
  </li>
  <li>
    <p>Next, under the <strong>Actions</strong> pane, click <strong>Advanced Settings</strong>.
<img src="/wip/images/IIS_Setup_24.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Advanced Settings</strong> dialog, under the <strong>General</strong> section, click on the <strong>elipsis</strong> button to set the <strong>Physical Path Credentials</strong>.
<img src="/wip/images/IIS_Setup_20.png" class="img-center" width="65%" /></p>
  </li>
  <li>
    <p>In the <strong>Connect As</strong> dialog, select <strong>Specific user</strong>. Then click the <strong>Set</strong> button to add your administrator credentials.
<img src="/wip/images/IIS_Setup_21.png" class="img-center" width="60%" /></p>
  </li>
  <li>
    <p>Enter the <strong>Username</strong> and <strong>Password</strong> associated with your administrator account. Hint: this should be the same username and password that you set in <a href="https://developer.rhino3d.com/guides/compute/deployToIIS/#creating-a-vm">step 7 when setting up Azure virtual machine</a>.
<img src="/wip/images/IIS_Setup_22.png" class="img-center" width="50%" /></p>
  </li>
  <li>
    <p>Click <strong>OK</strong> To save the credentials.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to save the user information.</p>
  </li>
  <li>
    <p>In the <strong>Advanced Settings</strong> dialog, change the <strong>Preload Enabled</strong> value to <strong>True</strong>.
<img src="/wip/images/IIS_Setup_25.png" class="img-center" width="65%" /></p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to save the settings.</p>
  </li>
</ol>

<p>Next, we need to edit the port bindings on the default website so that they do not conflict with the one we just set up for rhino.compute (ie. port 80).</p>

<ol>
  <li>
    <p>In the <strong>Connections</strong> pane, select the <strong>Default Web Site</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Actions</strong> pane, select <strong>Binding…</strong>.
<img src="/wip/images/IIS_Setup_27.png" class="img-center" width="100%" /></p>
  </li>
  <li>
    <p>In the <strong>Site Bindings</strong> dialog, select the row with the <strong>Type</strong> labeled <strong>http</strong>. Click the <strong>Edit</strong> button.
<img src="/wip/images/IIS_Setup_28.png" class="img-center" width="70%" /></p>
  </li>
  <li>
    <p>In the <strong>Edit Site Bindings</strong> dialog, change the <strong>Port</strong> number to <strong>8080</strong>. This number is arbitrary and can be any other valid port identifier other than 80.
<img src="/wip/images/IIS_Setup_29.png" class="img-center" width="70%" /></p>
  </li>
  <li>
    <p>Click <strong>Close</strong> on the <strong>Site Bindings</strong> dialog.</p>
  </li>
</ol>

<p>Lastly, you may need to restart the IIS server and/or RhinoCompute site for the changes to go into effect.</p>

<ol>
  <li>
    <p>In the <strong>Connections</strong> pane, select the <strong>RhinoComputeVM</strong> root server (one level up from the <strong>Application Pools</strong> and <strong>Sites</strong>).</p>
  </li>
  <li>
    <p>In the <strong>Actions</strong> pane, select <strong>Restart</strong>.</p>
  </li>
  <li>
    <p>After the server has been restarted, select the <strong>RhinoCompute</strong> site in the <strong>Connections</strong> pane.</p>
  </li>
  <li>
    <p>In the <strong>Actions</strong> pane, under the <strong>Manage Website</strong> heading, select <strong>Restart</strong>.</p>
  </li>
</ol>

<h3 id="edit-permissions">Edit Permissions</h3>

<p>The next thing we have to do is edit the permissions of the <strong>rhino.compute</strong> and <strong>compute.geometry</strong> subfolders. Open the <strong>File Explorer</strong> and navigate to those subfolders (Hint: they should be located in C:\inetpub\wwwroot\aspnet_client\system_web\4_0_30319).</p>

<ol>
  <li>
    <p>Right-click on the <strong>rhino.compute</strong> folder and click <strong>Properties</strong>.</p>
  </li>
  <li>
    <p>Click on the <strong>Security</strong> tab and then click <strong>Edit</strong>.
<img src="/wip/images/Edit_Permissions_1.png" class="img-center" width="55%" /></p>
  </li>
  <li>
    <p>For each group or user name, provide <strong>Full control</strong> access.</p>
  </li>
  <li>
    <p>Next, click the <strong>Add</strong> button.
<img src="/wip/images/Edit_Permissions_2.png" class="img-center" width="55%" /></p>
  </li>
  <li>
    <p>Under the section titled <strong>Enter the object names to select</strong>, type in <strong>IIS AppPool\RhinoComputeAppPool</strong>. Then, click on the <strong>Check Names</strong> button to verify the name.
<img src="/wip/images/Edit_Permissions_3.png" class="img-center" width="70%" /></p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
  <li>
    <p>Back in the <strong>Security</strong> tab, make sure the RhinoComputeAppPool object is select. Then check <strong>Full control</strong> to give full access to this app pool.
<img src="/wip/images/Edit_Permissions_4.png" class="img-center" width="55%" /></p>
  </li>
  <li>
    <p>Click <strong>Apply</strong> to modify the permissions.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong> to close the dialog.</p>
  </li>
</ol>

<p>Now, follow the same steps to provide <strong>Full control</strong> access to the <strong>compute.geometry</strong> folder.</p>

<h2 id="testing-the-app">Testing the app</h2>

<p>At this point, IIS should be configured to launch the rhino.compute instance when an API request is made. You can test this by opening a web browser on your local machine (not the VM) and typing in “http://” followed by the IP address of the virtual machine followed by a <code>:</code> and the port number (80) followed by “/activechildren”. So, the full address would look something like this:</p>

<pre><code>http://52.168.38.105:80/activechildren
</code></pre>

<p>The <code>/activechildren</code> endpoint will return an integer value for the number of child processes that were started by rhino.compute (the default is 4).</p>

<p>If you’ve succeeded in returning a numeric value larger than zero, then at least one child process has been started. Next, let’s try getting Hops to send a definition to that URL.</p>

<ol>
  <li>
    <p>Launch <strong>Rhino</strong> on your local machine.</p>
  </li>
  <li>
    <p>If you have not already installed hops on this machine, please do so by searching for it in the Rhino <strong>Package Manager</strong>.</p>
  </li>
  <li>
    <p>Start <strong>Grasshopper</strong> by typing the word <em>Grasshopper</em> into the command prompt and hitting enter.</p>
  </li>
  <li>
    <p>Go to <strong>File</strong> and then <strong>Preferences</strong> to open the preferences dialog.</p>
  </li>
  <li>
    <p>Click on the <strong>Solver</strong> tab in the left-hand menu.</p>
  </li>
  <li>
    <p>In the <strong>Hops - Compute server URLs</strong> section, type in the web address from above (do not include the <code>/activechildren</code> endpoint). Your URL should look something like this.
<img src="/wip/images/Hops_To_IIS_1.png" class="img-center" width="80%" /></p>
  </li>
  <li>
    <p>Add a <strong>Hops</strong> component to the <strong>Grasshopper canvas</strong> (Params/Util)</p>
  </li>
  <li>
    <p>Right-click on the <strong>Hops</strong> component and set the <strong>Path</strong> to a valid Hops/Grasshopper definition. To learn more about setting up a Grasshopper definition that will work properly with Hops, <a href="https://developer.rhino3d.com/guides/grasshopper/hops-component/">follow this guide</a>.
<img src="/wip/images/Hops_To_IIS_2.png" class="img-center" width="50%" /></p>
  </li>
</ol>

<p>Once the path is set, the Hops component will create the appropriate API request and send it to the URL that we specified in step 6 (the rhino.compute server running on IIS). The compute server processes the request and send a response back to Hops, which returns the result.
<img src="/wip/images/Hops_To_IIS_3.png" class="img-center" width="70%" /></p>

<p>Congratulations! You have successfully setup an instance of rhino.compute running behind IIS on a virtual machine.</p>

        </article>

      <!--</div>-->

    </div>
</div>
</div>

        <!--/div-->
      </div>

      <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">

      
        <div class="row">
          <div class="col-md-4">

            <p class="text">
              
                
                Author: <a href="/wip/authors/andy_payne">Andy Payne</a>
              
            </p>
          </div>
          <div class="col-md-4 text-center">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <a href="https://github.com/mcneel/developer-rhino3d-com/blob/master/_guide_topics/compute/deploy-to-iis.md" target="_blank">Edit page on GitHub</a>
          </div>
            <div class="col-md-4">
              <span class="pull-right">
                <span class="glyphicon glyphicon-cog"></span>&nbsp;<a href="/wip/admin">Admin</a>
              </span>
            </div>
        </div>

        <div class="row text-center">
          © 1997 - 2021 Robert McNeel &amp; Associates<br/>
          <span class="glyphicon glyphicon-heart-empty"></span>&nbsp;<a href="/wip/authors">Contributions welcome</a>
        </div>

      

    </div>

  </div>

  <script>
    if (navigator.appVersion.indexOf("Win")!=-1)
    {
      var body = document.getElementsByTagName("body");
      body[0].style.fontWeight = '400';
    }
  </script>

</footer>

    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- MathJax -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script type="text/javascript">
    $('body').scrollspy({
        target: '.bs-docs-sidebar',
        offset: 150 /* fixed header is about 40px high */
    });
    </script>
  </body>
</html>
